# Application Drupal

Ce socle applicatif est totalement découplée de tout hébergement.
Il peut être utilisé dans un environnement LAMP, tout comme dans un environnement docker par exemple.

**Remarque**: Vous pouvez utiliser docker pour votre de developpement. Cepandant, il faut installer le reverse proxy est créer le network avant de lancer l'ennvironnement.
Voir: https://gitlab.niji.fr/niji-tools/socles/docker-dev-host
Ensuite, sur votre machine lancer le script setup-dev-env

## Environnement de dev

Ci-dessous comment lancer votre environnement de developpement

Sur votre environnement Linux ou MAC OS:

```bash
./setup-dev-env.sh
```

Sur votre machine windows:

```Powershell
.\setup-dev-env.bat
```

## Permissions

Pour éviter les problèmes de permissions potentiels entre la machine hôte et les conteneurs (par exemple can't access files generated by PHP), utiliser le mécanisme des ACL, disponible sur la plupart des distributions Linux.

Au niveau de votre répertoire applicatif, lancer la commande suivante :

```bash
sudo setfacl -dR -m u:$(whoami):rwX -m u:82:rwX -m u:100:rX ./
sudo setfacl -R -m u:$(whoami):rwX -m u:82:rwX -m u:100:rX ./
```


**Sources**: https://github.com/wodby/docker4drupal/blob/master/docs/permissions.md

## Paramètres

Par défaut le fichier `parameters.dist.yml` est utilisé.

Pour définir ses propres paramètres, copier le fichier `parameters.dist.yml` en `parameters.yml` et modifier les paramètres

Les paramètres par défaut sont :

```yaml
additional_modules: &additional_modules
  - 'devel'
  - 'kint'
  - 'vardumper'
  - 'vardumper_console'
  - 'webprofiler'
cache_maxage: '31536000'
config_export_blacklist_module: *additional_modules
config_export_blacklist_config: 'null'
css_preprocess: 'TRUE'
db_host: 'mariadb'
db_name: 'drupal'
db_pass: 'drupal'
db_user: 'drupal'
error_level: 'verbose'
js_preprocess: 'TRUE'
redis_host: 'redis'
site_name: 'drupal'
```

## Installation / Mise à jour

### Build

`./automation/bin/build.sh`

Ajouter la paramètre `--mode dev` pour une inclure les dépendances de développement.

### Installation

`./automation/bin/install.sh`

Attention, la base de donnée est supprimée lors de chaque installation.

### Mise à jour

`./automation/bin/update.sh`

## Divers

### Reconstruire les paramètres

`composer prepare-settings`

### Code sniffer

`./automation/bin/code_sniffer.sh`

### Reset password

`./automation/bin/reset_password.sh`
